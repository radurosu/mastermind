// this version of MMS  is an MMS tester ... it runs the program automaticaly
// without user input
//
// last edited on 8/5/97.
// tryed the 1123 first guess.
// second guess hardcoded
import java.io.*;
import java.util.Date;
public class mmsTester{

    int tried[][][][] = new int[6][6][6][6];
    int codeList[][][][] = new int[6][6][6][6];

    int guessList[] = new int[1297]; //we will be starding at the one index

    int guessListIndex = 0; //holds the index in guessList where to get the next guess

    int board[][] = new int[6][10]; // the whole mastermind board 10 rows
                                    // and 6 collums 4 for guess 2 for response.
    int guess[] = {0,0,0,0,0,0};

    int numOfGuesses = 0;
    double totalGuesses = 0.0;
    int guessTotalTable[] ={0,0,0,0,0,0,0,0,0};
    int guessNumber =0;

    boolean solved = false;
    int theMaster[] = {0,0,0,0};//the master in array format
    int masterCopy[] = {0,0,0,0};
    //******************************************************///////
    //begin datastructures for opitimization processes.
    int remainingGuessList[] = new int[276];

   // int masterInt  =0;  //the master in interger format
   // String masterString = "0000";//the master in string format

  //  DataInputStream in=new DataInputStream(System.in);

    public static void main(String[] args)throws java.io.IOException{
        System.out.println("Welcome to the MasterMind solver!");
        mmsTester solver = new mmsTester();
        solver.runSolver();
    }//end main

    public mmsTester(){
        //initialize the guessList
        for(int i = 0; i<1296; i++)
           guessList[i] = i;

        mixGuessList();
        } //constructor

    public void runSolver() throws java.io.IOException{
        ///executes the solver for a set number of times on random codes
          Date theTime = new Date();
           for(int k = 0; k< 10000; k++){
              if(k%100 ==0)
                 System.err.println(k);
              getMaster();

              solved = false;
              solve();
              totalGuesses += guessNumber;
              guessTotalTable[guessNumber]++;
          }

          double average = 0.0;
          average = totalGuesses/10000.0;
          System.out.println(" We ran 10000 times.");
          System.out.println("The average # of guesses: " + average);
          for(int l = 1; l< 9; l++)
              System.out.println(l + " Guesses: " + guessTotalTable[l]);
          Date theNewTime = new Date();
          //int totalTime =0;

         // totalTime = theNewTime.getMinutes() - theTime.getMinutes();
          //System.out.println("It took us: " + totalTime + " seconds.");
          System.out.println("Work begun at:      " + theTime.toString());
          System.out.println("We are finished at: " + theNewTime.toString());
    }
    public void solve()
    {
        int temp = 0;
        //initialize the mastermind board
        for(int i=0; i<6; i++)
           for(int j = 0; j<10; j++)
              board[i][j] = temp;

        // this is the list of tried codes (randomized codes.)
        // the very ineficient part of the program.
        for(int i = 0; i< 6;i++)
            for(int j = 0; j < 6; j++)
                for(int k =0; k<6; k++)
                    for(int l =0;l<6;l++)
                        tried[i][j][k][l] = temp;

        mixGuessList(); //suffle the guess list.
        guessListIndex =0;
        guessNumber = 1;
        makeFirstGuess();
        if(board[4][1] == 4)
            solved = true;
        else{
            guessNumber++; //2
   /*     int x = new RandomIntGenerator(1, 6).draw();
        int y =x;
        while(y==x){
            y=new RandomIntGenerator(1, 6).draw();
        }
        */
            makeSecondGuess();

            if(board[4][2] == 4)
                solved = true;
            else
                guessNumber++;//3
        }
        while(!solved)
        {

            makeNewGuess();
           // System.out.print(". " );
            if(!verifyGuess())//if guess is not ok
                continue; //make an other guess
            //we have an ok guess ... register it
            GuessVMaster();

            for(int i = 0; i < 4; i++)
                board[i][guessNumber] = guess[i];
            board[4][guessNumber] = guess[4];//blacks
            board[5][guessNumber] = guess[5];//whites

            if(guess[4] == 4)
                solved = true;
            else
                guessNumber++;//going to the next guess

        }//end while


        if(guessNumber > 6){
            System.out.println(" Ooopps we got a "+ guessNumber);
            printBoard();
        }
    }

    public void mixGuessList(){

        for(int next = 0; next < 1295; next++){
            int r = new RandomIntGenerator(next, 1296).draw();
            int temp = guessList[next];
            guessList[next]=guessList[r];
            guessList[r] = temp;
        }
        guessListIndex =0;
    }
    public void makeNewGuess(){
   // for(int i = 0; i <1296; i++)
        int thisTry = guessList[guessListIndex];
        guessListIndex++;

        guess[0] = thisTry/216;
        thisTry = thisTry- guess[0]*216;
        guess[1] = thisTry/36;
        thisTry = thisTry- guess[1]*36;
        guess[2] = thisTry/6;
        guess[3] = thisTry- guess[2]*6 + 1;

        guess[0] = guess[0] +1;
        guess[1] = guess[1] +1;
        guess[2] = guess[2] +1;

  //      System.out.println(guess[0] + " " + guess[1] + " " + guess[2] + " " + guess[3] );
    }

    public void makeFirstGuess(){
        guessNumber = 1;

        guess[0] =1;
        guess[1] =1;
        guess[2] =2;
        guess[3] =3;

        GuessVMaster();

        for(int i = 0; i < 4; i++)
                board[i][guessNumber] = guess[i];
            board[4][guessNumber] = guess[4];
            board[5][guessNumber] = guess[5];
    }

    public void makeSecondGuess(){
        guessNumber = 2;
        guess[0] =0;
        guess[1] =0;
        guess[2] =0;
        guess[3] =0;

        if(board[4][1] == 0){
            if(board[5][1] == 4){
              guess[0] =2;
              guess[1] =3;
              guess[2] =1;
              guess[3] =1;
            }
            else if(board[5][1] == 3){
              guess[0] =2;
              guess[1] =3;
              guess[2] =4;
              guess[3] =5;
            }
            else if(board[5][1] == 2){
              guess[0] =2;
              guess[1] =4;
              guess[2] =3;
              guess[3] =4;
            }
            else if(board[5][1] == 1){
              guess[0] =2;
              guess[1] =4;
              guess[2] =4;
              guess[3] =5;
            }
            else if(board[5][1] == 0){
              guess[0] =4;
              guess[1] =4;
              guess[2] =5;
              guess[3] =6;
            }
        }
        else if(board[4][1] == 1){
            if(board[5][1] == 3){//4
              guess[0] =1;
              guess[1] =3;
              guess[2] =1;
              guess[3] =2;
            }
            else if(board[5][1] == 2){//84
              guess[0] =1;
              guess[1] =4;
              guess[2] =1;
              guess[3] =5;
            }
            else if(board[5][1] == 1){
              guess[0] =1;
              guess[1] =4;
              guess[2] =1;
              guess[3] =5;
            }
            else if(board[5][1] == 0){
              guess[0] =1;
              guess[1] =4;
              guess[2] =4;
              guess[3] =5;
            }
        }
        if(board[4][1] ==2){
            if(board[5][1] == 2){
              guess[0] =1;
              guess[1] =3;
              guess[2] =2;
              guess[3] =1;
            }
            else if(board[5][1] <= 1){
              guess[0] =1;
              guess[1] =2;
              guess[2] =4;
              guess[3] =5;
            }
        }
        if(board[4][1] == 3){

            guess[0] =1;
            guess[1] =2;
            guess[2] =4;
            guess[3] =5;
        }
        GuessVMaster();

        for(int i = 0; i < 4; i++)
                board[i][guessNumber] = guess[i];
            board[4][guessNumber] = guess[4];
            board[5][guessNumber] = guess[5];

    }

    public boolean verifyGuess(){
        //verifies that a guess is valid consideting the previous ones.
        int rowNumber = 1;
        int rowCopy[]= {0,0,0,0,0,0};
        int guessCopy[] = {0,0,0,0,0,0};

        if(tried[guess[0]-1][guess[1]-1][guess[2]-1][guess[3]-1] == 1)
            return false;//if we have done this one before get an other one
        else
            tried[guess[0]-1][guess[1]-1][guess[2]-1][guess[3]-1] = 1;


        while(rowNumber < guessNumber){// for every previous row
            // make a copy of that row and a copy of the guess

        //    System.out.print(rowNumber+ " ");

            for(int i = 0; i<4; i++){
                rowCopy[i] = board[i][rowNumber];
                guessCopy[i] = guess[i];
            }

            //check the blacks
            rowCopy[4] = 0;
            for(int i = 0; i < 4; i++)
                if(rowCopy[i] == guessCopy[i]){
                    guessCopy[i] = -1;//used
                    rowCopy[i] = -2;
                    rowCopy[4]++;
                }

            //check whites
            rowCopy[5] = 0;
            for(int i = 0; i < 4; i++)
                for(int j = 0; j < 4; j++)
                    if(guessCopy[i] == rowCopy[j]){
                        guessCopy[i]= -3;
                        rowCopy[j]=-4;
                        rowCopy[5]++;
                        break;
                    }
            if((rowCopy[4] != board[4][rowNumber]) ||
                (rowCopy[5] != board[5][rowNumber]))
                return false;
            // else ..that is if this row is ok with our guess go to  the next
            rowNumber++;
        }

        return true;
    }

    public void GuessVMaster(){
        //compares guesss to a master
        guess[4]=0;
        guess[5]=0;
        int guessCopy[] = {0,0,0,0,0,0};
        for(int i = 0 ; i< 4 ; i++){
           guessCopy[i] = guess[i];
           masterCopy[i] = theMaster[i];}

        for(int i = 0; i < 4; i++){
            if(guessCopy[i] == masterCopy[i]){
                guessCopy[i] = -1;//used
                masterCopy[i] = -2;
                guess[4]++;
            }
        }

        for(int i =0; i < 4; i++)
            for(int j = 0; j <4; j++){
                if(guessCopy[j] == masterCopy[i]){
                    guessCopy[j] = -1; //used
                    masterCopy[i] = -2;
                    guess[5]++;
                    break;
                }
            }
    }


    public void printBoard(){
        System.out.println("\n The computer did this: ");
        for(int i = 1; i<= guessNumber; i++){
            for(int j = 0; j < 4; j++)
                System.out.print(board[j][i] + " ");
            System.out.print(" ");
            for(int j = 4; j<6;j++)
                System.out.print(board[j][i] + " ");
            System.out.println();
            }
    }

    public boolean getMaster()throws java.io.IOException{
    //get the master code
         for(int i =0; i <4; i++)
            theMaster[i]=new RandomIntGenerator(1, 6).draw();
         return true;

     /*      input_loop: while(true){
            System.out.println("\nValid digits are 1..6, a master has four digits");
            System.out.print("Please enter your master: ");

            masterString = "2233";//in.readLine();
            try{
                masterInt = Integer.valueOf(masterString).intValue();
            }
            catch(Exception NumberFormatExeption)
            {   System.out.println(" Bummer...sorry but we only take numbers!");
                continue;}
            theMaster[0] = masterInt/1000;
            masterInt = masterInt- theMaster[0]*1000;
            theMaster[1] = masterInt/100;
            masterInt = masterInt- theMaster[1]*100;
            theMaster[2] = masterInt/10;
            theMaster[3] = masterInt- theMaster[2]*10;
            for(int i =0 ; i<4 ; i++)
                if(theMaster[i] ==0 || theMaster[i]>6){
                System.out.println("Your master was improper.");
                continue input_loop;
            }
            //everything is fine
            break;
        }//end while  */

    }

}


